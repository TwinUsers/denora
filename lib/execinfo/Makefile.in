# Makefile for Denora.
#
# (c) 2004-2014 Denora Team
# Contact us at info@denorastats.org
#
# Please read COPYING and README for further details.
#
# Based on the original code of Anope by Anope Team.
# Based on the original code of Thales by Lucas.
#
# 
#


CCDV=@CCDV@
CC=$(CCDV)@CC@
INCLUDEDIR=../include 
DENORALIBS=@DENORALIBS@
BASEOPT=-O2
CFLAGS=@CFLAGS@
OPCFLAGS=@OPCFLAGS@
STRICT=@STRICT@
ANSI=-Wall -ansi -pedantic
PROFILE=-pg
LDPROFILE=
SHELL=/bin/sh
SUBDIRS=src
LIBDIRS=lib
BINDEST=@BINDEST@
DATDEST=@DATDEST@
INSTALL=@INSTALL@
RM=@RM@
CP=@CP@
TOUCH=@TOUCH@
MODULE_PATH=@MODULE_PATH@
MYSQL=@MYSQL@
MYSQL_CLIENT_LIBS=@MYSQL_CLIENT_LIBS@
LDFLAGS=@LDFLAGS@
RUNGROUP=@RUNGROUP@
SHARED=@SHARED@
RDYNAMNIC=@RDYNAMNIC@
MODULEFLAGS=@MODULEFLAGS@

OBJS =  execinfo.o stacktraverse.o
        
SRCS =  execinfo.c stacktraverse.c
        

INCLUDES = execinfo.h stacktraverse.h

MAKEARGS = 'CFLAGS=${CFLAGS}' 'CC=${CC}' 'DENORALIBS=${DENORALIBS}' \
	   'LDFLAGS=${LDFLAGS}' 'BINDEST=${BINDEST}' 'INSTALL=${INSTALL}' \
           'INCLUDEDIR=${INCLUDEDIR}' 'RM=${RM}' 'CP=${CP}' \
      	   'TOUCH=${TOUCH}' 'SHELL=${SHELL}' 'DATDEST=${DATDEST}' \
  	   'RUNGROUP=${RUNGROUP}' 'MODULE_PATH=${MODULE_PATH}' \
	   'SHARED=${SHARED}' 'MODULEFLAGS=${MODULEFLAGS}' 'RDYNAMNIC=${RDYNAMNIC}'


.c.o:
	$(CC) $(CFLAGS) -c $<

all: libexecinfo.la

distclean: spotless

libexecinfo.la:  $(OBJS)
	$(CC) -shared -Wl,-soname,libdenora_execinfo.so -o libdenora_execinfo.so  *.o -lm

$(OBJS): Makefile
execinfo.o:		execinfo.c  $(INCLUDES)
stacktraverse.o:   stacktraverse.c       $(INCLUDES)

clean:
	rm -f *.o libdenora_execinfo.so libdenora_execinfo.a a.out

spotless:
	rm -f *.o libdenora_execinfo.so libdenora_execinfo.a a.out Makefile

install: libexecinfo.la
	test -d ${BINDEST} || mkdir ${BINDEST}
	test -d ${BINDEST}/lib || mkdir ${BINDEST}/lib
	$(INSTALL) libdenora_execinfo.so $(BINDEST)/lib/libdenora_execinfo.so

DUMMY:
	